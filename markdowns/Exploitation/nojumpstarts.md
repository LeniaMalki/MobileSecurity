# Solution

## Description of the problem
You must understand how the chain of actions relates to each other by understanding the messages and signatures
that are passed aorund. 


## Solution

Decompiled code shows that we have the three activities below (excepts for MainActivity):

````
<activity android:name="com.mobisec.nojumpstarts.A" />
<activity android:name="com.mobisec.nojumpstarts.B" />
<activity android:name="com.mobisec.nojumpstarts.C">
````

And the intent filter: `<action android:name="mobisec.intent.getflag" />` In MainActivity.onCreate()
we see a button called `getflagButton` is present. This has a onClick listener which, if clicked,
will try to call `MainActivity.this.getFlag();` which is the code below:

````
public void getFlag() throws Exception {
        Intent i = Main.buildIntent("Main", "A", null);
        startActivityForResult(i, 400);
    }
````

Heading over to `public static Intent buildIntent(String src, String dst, String chain)` in Main. This returns an Intent
object. The message string is signed using the sign(msg) method. We are basically finding ourselves in a chain call of
functions. The `startActivityForResult(i, 400);` is then called using the returned intent object. There is a
authentication message and signature for each intent. We can for example see in A.java that the expected message
is `private static String expectedMsg = "Main-to-A";`. A in turn passes the "action" to B through
`Intent intent = Main.buildIntent("A", "B", msg);`. The expected message in B
is `private static String expectedMsg = "Main-to-A/A-to-B";` and B passes on the call to C if:

````
if (msg != null && sign != null && msg.equals(expectedMsg) && Main.verify(msg, sign)) {
````

At last, if all the conditions goes through, all signed messages and expected messages are in order,
C will pass over the flag by `reply(MainActivity.flag);`.

In order to get the flag, we have to pass the right signatures and messages to C. We can thus create our own standalone
application and try to start activity C directly. In the `BuildConfig.java` we can see get the values for `FLAVOR` and
`APPLICATION_ID`. We can substitute these directly into our own version of the Main.java file. In our MainActivity.java
file, we only need the following:

````
private static final String msg = "Main-to-A/A-to-B/B-to-C";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        Intent i = new Intent();
        i.setComponent(new ComponentName("com.mobisec.nojumpstarts", "com.mobisec.nojumpstarts.C"));
        i.putExtra("authmsg", msg);
        try {
            i.putExtra("authsign", Main.sign(msg));
        } catch (Exception e) {
            Log.w("MOBISEC", Log.getStackTraceString(e));
        }
        startActivityForResult(i, 1);
    }
```` 

Important to notice here is the `String msg` that specifies the "path" that has to be passed to the intent in order
to get the flag directly. This was previously set to "dummyflag" which was quite revealing. What's worth to notice is that we only
need the `getPrivateKeySpec(), getPrivateKey() and sign()` in our Main.java class in order to get the key. 